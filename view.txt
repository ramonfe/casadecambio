USE [opt]
GO

/****** Object:  View [dbo].[v_yield_general]    Script Date: 5/7/2020 11:57:07 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


CREATE  VIEW [dbo].[v_yield_general] as

SELECT batch , sku , y.fk_line , y.fk_product , y.fk_process , part , filled , quality , defects,isnull([target],1)[target]
FROM v_yield_master y with (nolock)
left outer join [dbo].[yield_target_local_code]lc with (nolock)on SUBSTRING(sku,1,7) = local_code and y.fk_process = lc.fk_process
WHERE y.fk_line in (select fk_line from[dbo].[reports_lines_process]where fk_reports_process = 14 and st =1)
union all
SELECT batch , sku , y.fk_line , Y.fk_product , y.fk_process , part , filled , quality , defects ,isnull([target],1)[target]
FROM v_yield y with (nolock)
left outer join [dbo].[yield_target_local_code]lc with (nolock) on SUBSTRING(sku,1,7) = local_code and y.fk_process = lc.fk_process
WHERE  y.fk_line not in (select fk_line from[dbo].[reports_lines_process]where fk_reports_process = 14 and st =1)
GO